# pixelpal
## Описание
Небольшой сайт для создания и редактирования пиксельных картин в реальном времени.
Написан на Svelte & Elysia.
## Установка и запуск
```bash
git clone https://github.com/hayshin/pixelpal.git
cd pixelpal
direnv allow # if using devenv
bun install
```
## История создания
### 1. Создание канваса
Изначально было принято решение использовать канвас, так как с ним имелся опыт работы в предыдущем проекте и он более удобным по сранению с сеткой блоков. Была написана первоначальная логика работы.
### 2. Создание вебсокетов
Следом последовало создание логики работы вебсокетов для поддержки редактирования в реальном времени - они по стандарту поддерживают поддержку тем (topics), на которые можно подписываться и рассылать по ним сообщения всем остальным пользователям. В качестве темы выступает ID картины, к которой подключены активные пользователи.
### 3. Создание остального бэкенда
Добавлены роуты для создания картины, пользователя, обновления данных об картине после отключения всех пользователей от темы. Добавлено сохранение картин, к которым подключался/создавал пользователь, чтобы в дальнейшем их отображать.
### 4. Создание интерфейса
Создание главного меню, кнопок, небольшое изменение интерфейса канваса.
## Уникальные подходы и методологии
Был использован End-to-end typesafe API Eden, который является аналогом tRPC, для безопасной разработки с поддержкой типизации в монорепозитории клиентской и серверной части.
Использован Devenv.nix, так как я использую NixOS. Он предоставляет возможность декларативно конфигурировать рабочее окружение, в том числе скрипты, версии пакетов (приложений), а также процессов, заменяя/дополняя Docker, позволяя гарантировать работоспособность на любом другом устройстве, использующем Nix. Но так как в этом проекте был использован лишь typescript, особой пользы он не принес.
## Компромисы, принятые во время разработки
В самом начале было принято глупое решение об использовании Rust в качестве бэкенда, так как имеющийся опыт с Java Spring не был слишком большим чтобы дать преимущество в скорости разработки, к тому же Java была мне не особо по душе. Но как оказывается (удивительно, не правда ли?) разработка бэкенда на Rust занимает непропорционально получаемому удовольствию время, и я решил перейти на более простой стек и выбрал совсем новый фреймворк (и для меня, и в общем) Elysia.
Из-за отсутствия времени и достаточного опыта, разработкой интерфейса занимался в основном ИИ.
## Ошибки и проблемы
### Оптимизация прорисовки доски
Сейчас она отрисовывается как размер * 8(размер одного пикселя), что для больших досок (> 200) вызывает проблемы с производительностью. Чтобы решить эту проблему, можно было ограничить размеры самого канваса, и вместо этого менять размер самого отрисовываемого пикселя, что также добавит возможность приближать и отдалять.
### Отсутствие отображения активных пользователей
Нужно добавить панель с активными пользователями, которые редактируют картину
### Отсутствие отображения инструментов
На данный момент доступно только изменения цвета и размера кисточки. Чтобы рисовать, надо нажать/зажать ЛКМ. Чтобы стереть, надо нажать/зажать ПКМ. Надо добавить для этого UI. Также отсутствует палитра цветов.
### Отсутствует решение Data Race
Нет никакой надежности в том, что два юзера не поменяют одновременно один и тот же пиксель, что вызывает рассинхронизацию/баг. Но и заблокирования потока, не ожидается, вроде бы.
## Технический стэк
SvelteKit - имелся небольшой опыт. Приятно выглядит, non-bloated. Быстрый (что, в общем-то, не оказывает эффекта на данным проекте). Логика рун показалась проще, чем в других фреймворках.
Elysia - даже не помню, где я это достал. Несмотря на плохую документацию, в связке с Eden довольно приятно писать клиентскую часть, так как на ней имеются все типы, что есть на сервере. Также доступен OpenAPI (Swagger), где можно проверить пути. По сравнению с фреймворками, которые я использовал до этого для бэка - тоже non-bloated.
DrizzleORM - нужна была ORM, так как Elysia micro-framework. Прошлый опыт с Prisma был крайне негативным, отчего решил попробовать популярную альтернативу. Не пожалел, вроде все хорошо. (но присутствует баг с миграциями на Bun)
Bun - быстрый run-time для js/ts, нативный для Elysia. Был наслышан о нем, хотел попробовать.

Если в общем посмотреть, все какое-то не такое. Я люблю поэкспериментировать и не боюсь нового...
