# History of development
## Проблема прерывающейся линии
При зажатой ЛКМ, рисуется линия по линии движени курсора. Но возникает проблема - из-за медленного обновления этих движений (MouseEvent/PointerEvent) линия становится прерывистой. Можно попробовать решить это или через requestAnimationFrame или через алгоритм Брезенхэма. Попробую первое

Ладно. Ни запросы на анимацию, ни метод getCoalescedEvents() сильно не помогли. попробуем рисовать линии между двумя точками - прошлой и нынешней. для этого придется воспользоваться алгоритмом брезенхэма.
# Description

# Install & run

# Development
## 1. Стек технологий
Из вариантов на фронтенде был только Svelte, так как я имел с ним опыт в прошлом проекте. Да и разница, если основной код будет на Typescript. На бэкенде посложнее - есть Java Spring, в котором почти не надо ничего писать, и какой-нибудь фреймворк на Rust (Axum/Actix из возможных вариантов, но нужно проверить легкость работы с вебсокетами). По идеи, так как для работы дано всего четыре дня - лучше выбрать первое, так как для последнего придется писать бойлерплейт. Но мне нравится Rust, и уже тошнит от Java. И давно была идея написать бэкенд на Rust. Поэтому выбираю его.
## 2. Реализация
### Canvas vs CSS Grid
Нам явно нужен HTML Canvas для быстрой обработки и удобного API. Как реализовывать пиксели - напрямую выставлять ему такое же разрешение, и при клике менять цвет только одного пикселя? Ссылаясь на пиксельное изменение Canvas (https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas), можно предпочесть его - но он ререндерит весь канвас при изменение одного пикселя, но дает по ощущениям больше контроля чем прорисовка прямоугольников. По сути, так как рисование подразумевает под собой изменение только лишь определенных пикселей, лучшем вариантом будет отрисовывать каждый пиксель как прямоугольник. Также это в будущем можно использовать для прорисовки альфа-канала (как в adobe photoshop делать один такой пиксель в виде сетки серо-черных поменьше).
### Changes
Как отправлять изменения? Так как я собираюсь писать приложение сразу с Websockets(у меня был с ними опыт, и это не сильно сложнее), то приложение будет real-time. Для этого надо поддерживать быструю обработку изменений - и не зачем отправлять от клиента весь канвас за раз, можно лишь отправлять только те пиксели, что изменились. Это, кстати, возможно сериализовать в байты (height, width, rgb(не вижу смысла вводить альфа-канал на первом этапе)), что выйдет в log(height)+log(width)+24 битов, для будущего простора оптимизации.(но так как premature optimization is root of all evil, обойдемся обычными запросами). После изменения пикселя сервер броадкастит для всех пользователей доски изменение и лочит этот пиксель на секунду(или другое время). Надо гарантировать что не будет дед-лока и два юзера одновременно не изменят один пиксель, но кажется tokyo и сам разберется. Залоченный пиксель можно как нибудь помечать для удобства UX, к примеру сделать переход от цвета курсора пользователя что внес изменения до того цвета, который у пикселя.
А что насчет обработки "зажатия" ЛКМ - передавать каждый пиксель по отдельности, или разом? Думаю, пока что по отдельности.
### States
Как хранить состояния доски? Vec<vec<color>>, где color {red: u8, blue: u8, green: u8}. На стороне клиента тоже самое - просто матрица цветов. Для каждой доски можно давать уникальное uid и делиться доступом по ссылке. Можно также добавить права на редактирование - по умолчанию новошедшие будут лишь смотреть за изменениями, и владелец должен будет дать права для изменения. Прикольно. Саму доску после окончании сессии и раз в минуту можно сохранять в sqlite в виде blob`a, и десериализовывать через Serde? на бэке в матрицу, и отправлять соответственно клиенту. Можно дать также пароль юзерам, но для первого времени можно обойтись просто никами. Есть еще пространство для размышлений над оффлайн управлением, но это пока лишнее.
### Architecture
На фронте - MVC? В принципе, будет три компонента (пока что) - доска, список пользователей, палитра. Так как тут только лишь доска и единственное, что можно - это менять цвет, то реактивности почти нет.
На бэкенде - пользователи, доски в sqlite, и активные комнаты с реализацией в виде вебсокетов. Кстати, ведь доска и подразумевает под собой комнату с пользователями.

